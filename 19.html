<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Typing Master Pro</title>
    <style>
        :root {
            --bg: #000;
            --p: #fff;
            --pri: #4f46e5;
            --txt: #1e293b;
            --sc: 1;
            --tfs: 1.1rem;
            --gl: rgba(79, 70, 229, 0.08);
            --bd: rgba(0, 0, 0, 0.1);
            --font-main: "Segoe UI", "Tahoma", "Kruti Dev 010", "Mangal", "Arial Unicode MS", sans-serif
        }

        body.dark {
            --bg: #000;
            --p: #000;
            --pri: #6366f1;
            --txt: #f1f5f9;
            --gl: rgba(255, 255, 255, 0.05);
            --bd: rgba(255, 255, 255, 0.2)
        }

        body {
            font-family: var(--font-main);
            background: var(--bg);
            color: var(--txt);
            margin: 0;
            min-height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: safe center;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden
        }

        .m {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: safe center;
            z-index: 100;
            backdrop-filter: blur(4px);
            padding: 10px;
            overflow: auto
        }

        .m.active {
            display: flex
        }

        .c {
            background: var(--p);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 1000px;
            border: 1px solid var(--bd);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            transform: scale(var(--sc));
            transform-origin: top center;
            margin: auto;
            position: relative
        }

        .cb {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            margin-bottom: 10px
        }

        .cb button {
            padding: 3px 6px;
            font-size: 0.65rem;
            background: var(--gl);
            color: inherit;
            border: 1px solid var(--bd);
            cursor: pointer;
            border-radius: 4px
        }

        .nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px
        }

        .ls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px
        }

        .sc {
            background: var(--gl);
            border: 1px solid var(--bd);
            padding: 8px;
            border-radius: 8px;
            text-align: center
        }

        .sv {
            font-weight: 800;
            font-size: 1rem;
            display: block;
            color: var(--pri)
        }

        .sl {
            font-size: 0.55rem;
            opacity: 0.8;
            text-transform: uppercase;
            font-weight: bold
        }

        .g {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            font-size: 0.8rem
        }

        .f-col {
            display: flex;
            flex-direction: column;
            gap: 4px
        }

        .cg {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 12px 0;
            padding: 10px;
            background: var(--gl);
            border-radius: 10px;
            border: 1px solid var(--bd)
        }

        .chk-row {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            user-select: none;
            font-size: 0.8rem
        }

        select,
        textarea,
        input:not([type="checkbox"]) {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--bd);
            border-radius: 6px;
            background: var(--p);
            color: inherit;
            outline: none;
            font-size: 0.85rem;
            box-sizing: border-box;
            font-family: var(--font-main)
        }

        .ta,
        #ia,
        #dv {
            font-size: var(--tfs);
            line-height: 1.5;
            border: 1px solid var(--bd);
            padding: 12px;
            margin: 8px 0;
            background: var(--gl);
            border-radius: 10px;
            scrollbar-width: thin;
            font-family: var(--font-main)
        }

        .ta {
            height: 25vh;
            overflow-y: auto;
            white-space: normal
        }

        .ta span {
            display: inline-block;
            margin-right: 0.5ch;
            padding: 0 2px;
            border-radius: 3px
        }

        .as-on {
            overflow-y: hidden !important
        }

        #ia {
            height: 10vh;
            resize: none;
            white-space: pre-wrap
        }

        #dv {
            height: 12vh;
            overflow-y: auto;
            white-space: pre-wrap
        }

        .cor {
            color: #10b981
        }

        .inc {
            color: #ef4444;
            text-decoration: underline;
            font-weight: bold
        }

        #rc {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
            max-height: 45vh;
            overflow-y: auto;
            padding-right: 5px;
            scrollbar-width: thin
        }

        .sg {
            padding: 10px;
            background: var(--gl);
            border-radius: 10px;
            border: 1px solid var(--bd);
            display: flex;
            flex-direction: column;
            gap: 1px
        }

        .rl {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
            font-size: 0.75rem;
            border-bottom: 1px solid var(--bd)
        }

        .mh {
            font-weight: 700;
            color: var(--pri);
            font-size: 0.8rem;
            margin-bottom: 4px;
            line-height: 1.2
        }

        .ms {
            font-size: 1.1rem;
            font-weight: 900;
            margin: 4px 0;
            color: var(--txt)
        }

        .bp {
            background: var(--pri);
            color: #fff;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 700;
            margin-top: 8px
        }

        .bs {
            background: var(--p);
            color: inherit;
            border: 1px solid var(--bd);
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7rem
        }

        .back-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 1.4rem;
            padding: 0 8px;
            display: flex;
            align-items: center
        }

        #confirm {
            z-index: 200
        }
    </style>
</head>

<body class="dark">
    <div id="cfg" class="m active">
        <div class="c" style="max-width:700px">
            <div class="cb" data-type="h"></div>
            <h2 style="margin:0 0 12px 0;color:var(--pri);font-size:1.4rem">Typing Master Pro</h2>
            <div class="g">
                <div class="f-col"><span>Name</span><input id="un" value="Guest"></div>
                <div class="f-col"><span>Time</span><select id="tl">
                        <option value="1">1 Min</option>
                        <option value="5">5 Min</option>
                        <option value="10" selected>10 Min</option>
                        <option value="15">15 Min</option>
                        <option value="20">20 Min</option>
                        <option value="25">25 Min</option>
                        <option value="30">30 Min</option>
                    </select></div>
                <div class="f-col"><span>Keyboard</span><select id="ime">
                        <option value="e">English</option>
                        <option value="i">Inscript</option>
                        <option value="p">Indic</option>
                        <option value="g" selected>Gail</option>
                        <option value="c">CBI</option>
                    </select></div>
                <div class="f-col"><span>Ignore Err %</span><input type="number" id="ip" value="5"></div>
                <div class="f-col"><span>Mode</span><label class="chk-row" style="height:36px"><input type="checkbox"
                            id="pt" onchange="tp(this.checked)"> Custom Matter</label></div>
                <div class="f-col du"><span>Playlist</span><select id="ps" onchange="lp(this.value)"></select></div>
                <div class="f-col du"><span>Matter</span><select id="ms"></select></div>
                <div class="f-col cu" style="display:none"><span>Library</span>
                    <div style="display:flex;gap:6px"><select id="cms"></select><button class="bs"
                            onclick="sm('lib')">Library</button></div>
                </div>
            </div>
            <div class="cg"><label class="chk-row"><input type="checkbox" id="wl"
                        onchange="get('wv').style.display=this.checked?'inline':'none'"> Words Limit</label><input
                    type="number" id="wv" value="50" style="width:65px;display:none;padding:4px"><label
                    class="chk-row"><input type="checkbox" id="bk" checked> Backspace</label><label
                    class="chk-row"><input type="checkbox" id="hi" checked> Highlight</label><label
                    class="chk-row"><input type="checkbox" id="as" checked> Auto Scroll</label></div><button class="bp"
                id="sb" onclick="st()">Start Practice</button>
        </div>
    </div>
    <div id="lib" class="m">
        <div class="c" style="max-width:550px">
            <h3>Custom Library</h3>
            <div id="ll" style="max-height:220px;overflow-y:auto;margin-bottom:10px;border:1px solid var(--bd);border-radius:6px"></div>
            <input id="ct" placeholder="Title" style="margin-bottom:6px"><textarea id="cx" rows="5"
                placeholder="Paste matter..."></textarea>
            <div style="display:flex;gap:8px;margin-top:8px"><button id="lib-save-btn" class="bp" onclick="al()"
                    style="margin-top:0">Add to Library</button><button class="bp" onclick="sm('cfg')"
                    style="background:#475569;margin-top:0">Back</button></div>
        </div>
    </div>
    <div id="confirm" class="m">
        <div class="c" style="max-width:320px;text-align:center">
            <h3 style="margin-top:0">Discard Progress?</h3>
            <p>Current session data will be lost.</p>
            <div style="display:flex;gap:10px"><button class="bp" onclick="sm('cfg')"
                    style="background:#ef4444">Yes, Discard</button><button class="bp"
                    onclick="get('confirm').classList.remove('active')" style="background:#475569">No, Continue</button>
            </div>
        </div>
    </div>
    <div id="typ" class="m">
        <div class="c">
            <div class="nav-row"><button class="back-btn" onclick="get('confirm').classList.add('active')">‚Üê</button>
                <div id="typing-info" style="font-size:0.75rem;opacity:0.7;font-weight:bold;text-transform:uppercase">
                </div>
                <div class="cb" data-type="f"></div>
            </div>
            <div class="ls">
                <div class="sc"><span class="sv" id="lt">00:00</span><span class="sl">Time Left</span></div>
                <div class="sc"><span class="sv" id="ls">0 | 0</span><span class="sl">G | N WPM</span></div>
                <div class="sc"><span class="sv" id="la">0% | 0</span><span class="sl">Acc | Words</span></div>
            </div>
            <div id="tt" class="ta"></div><textarea id="ia" spellcheck="false"
                placeholder="Start typing..."></textarea><button class="bp" onclick="ft()">Submit Results</button>
        </div>
    </div>
    <div id="res" class="m">
        <div class="c">
            <div class="nav-row"><button class="back-btn" onclick="st()">‚Üê</button>
                <div class="cb" data-type="f"></div>
            </div>
            <h3 style="margin:0 0 10px 0">Performance Analysis</h3>
            <div id="rc"></div>
            <div id="dv"></div><button class="bp" onclick="sm('cfg')">New Practice Session</button>
        </div>
    </div>
    <script>
        const remGailMap = { 'q': '‡•Å', 'w': '‡•Ç', 'e': '‡§Æ', 'r': '‡§§', 't': '‡§ú', 'y': '‡§≤', 'u': '‡§®', 'i': '‡§™', 'o': '‡§µ', 'p': '‡§ö', '[': '‡§ñ‡•ç', ']': ',', 'a': '‡§Ç', 's': '‡•á', 'd': '‡§ï', 'f': '‡§ø', 'g': '‡§π', 'h': '‡•Ä', 'j': '‡§∞', 'k': '‡§æ', 'l': '‡§∏', ';': '‡§Ø', '\'': '‡§∂‡•ç', 'z': '‡•ç‡§∞', 'x': '‡§ó', 'c': '‡§¨', 'v': '‡§Ö', 'b': '‡§á', 'n': '‡§¶', 'm': '‡§â', ',': '‡§è', '.': '‡§£‡•ç', '/': '‡§ß‡•ç', 'Q': '‡§´', 'W': '‡•Ö', 'E': '‡§Æ‡•ç', 'R': '‡§§‡•ç', 'T': '‡§ú‡•ç', 'Y': '‡§≤‡•ç', 'U': '‡§®‡•ç', 'I': '‡§™‡•ç', 'O': '‡§µ‡•ç', 'P': '‡§ö‡•ç', '{': '‡§ï‡•ç‡§∑‡•ç', '}': '‡§¶‡•ç‡§µ', 'A': '‡§æ', 'S': '‡•à', 'D': '‡§ï‡•ç', 'F': '‡§•‡•ç', 'G': '‡§≥', 'H': '‡§≠‡•ç', 'J': '‡§∂‡•ç‡§∞', 'K': '‡§ú‡•ç‡§û', 'L': '‡§∏‡•ç', ':': '‡§∞‡•Ç', '"': '‡§∑‡•ç', 'Z': '‡§∞‡•ç', 'X': '‡§ó‡•ç', 'C': '‡§¨‡•ç', 'V': '‡§ü', 'B': '‡§†', 'N': '‡§õ', 'M': '‡§°', '<': '‡§¢', '>': '‡§ù', '?': '‡§ò‡•ç', '1': '‡•ß', '2': '‡•®', '3': '‡•©', '4': '‡•™', '5': '‡•´', '6': '‡•¨', '7': '‡•≠', '8': '‡•Æ', '9': '‡•Ø', '0': '‡•¶', '-': ';', '_': '.', '=': '‡•É', '!': '‡•§', '@': '/', '#': ':', '$': '*', '%': '-', '^': '‚Äò', '&': '\'', '*': '‡§¶‡•ç‡§ß', '(': '‡§§‡•ç‡§∞', ')': '‡§ã', '+': '‡•ç', '`': '‡§º', '~': '‡§¶‡•ç‡§Ø', '\\': '(', '|': ')' }, remCBIMap = { 'q': '‡•Å', 'w': '‡•Ç', 'e': '‡§Æ', 'r': '‡§§', 't': '‡§ú', 'y': '‡§≤', 'u': '‡§®', 'i': '‡§™', 'o': '‡§µ', 'p': '‡§ö', '[': '‡§ñ‡•ç', ']': ',', 'a': '‡§Ç', 's': '‡•á', 'd': '‡§ï', 'f': '‡§ø', 'g': '‡§π', 'h': '‡•Ä', 'j': '‡§∞', 'k': '‡§æ', 'l': '‡§∏', ';': '‡§Ø', '\'': '‡§∂‡•ç', 'z': '‡•ç‡§∞', 'x': '‡§ó', 'c': '‡§¨', 'v': '‡§Ö', 'b': '‡§á', 'n': '‡§¶', 'm': '‡§â', 'Q': '‡§´', 'W': '‡•Ö', 'E': '‡§Æ‡•ç', 'R': '‡§§‡•ç', 'T': '‡§ú‡•ç', 'Y': '‡§≤‡•ç', 'U': '‡§®‡•ç', 'I': '‡§™‡•ç', 'O': '‡§µ‡•ç', 'P': '‡§ö‡•ç', 'A': '‡§æ', 'S': '‡•à', 'D': '‡§ï‡•ç', 'F': '‡§•‡•ç', 'G': '‡§≥', 'H': '‡§≠‡•ç', 'J': '‡§∂‡•ç‡§∞', 'K': '‡§ú‡•ç‡§û', 'L': '‡§∏‡•ç', 'Z': '‡§∞‡•ç', 'X': '‡§ó‡•ç', 'C': '‡§¨‡•ç', 'V': '‡§ü', 'B': '‡§†', 'N': '‡§õ', 'M': '‡§°', '-': ';', '=': '‡•É', '`': '‡§º', '~': '‡§¶‡•ç‡§Ø', '!': '‡•§', '@': '//', '#': ':', '$': '*', '%': '-', '^': '\'', '&': '\'', '*': '‡§¶‡•ç‡§ß', '(': '‡§§‡•ç‡§∞', ')': '‡§ã', '+': '‡•ç', '{': '‡§ï‡•ç‡§∑‡•ç', '}': '‡§¶‡•ç‡§µ', '<': '‡§¢', '>': '‡§ù', '?': '‡§ò‡•ç', '\\': '(', '|': ')', '.': '‡§£‡•ç', '/': '‡§ß‡•ç', ',': '‡§è', '_': '.', ':': '‡§∞‡•Ç', '"': '‡§∑‡•ç' }, inscriptMap = { 'q': '‡•å', 'w': '‡•à', 'e': '‡§æ', 'r': '‡•Ä', 't': '‡•Ç', 'y': '‡§¨', 'u': '‡§π', 'i': '‡§ó', 'o': '‡§¶', 'p': '‡§ú', '[': '‡§°', ']': '‡§º', 'a': '‡•ã', 's': '‡•á', 'd': '‡•ç', 'f': '‡§ø', 'g': '‡•Å', 'h': '‡§™', 'j': '‡§∞', 'k': '‡§ï', 'l': '‡§§', ';': '‡§ö', '\'': '‡§ü', 'z': '‡•Ü', 'x': '‡§Ç', 'c': '‡§Æ', 'v': '‡§®', 'b': '‡§µ', 'n': '‡§≤', 'm': '‡§∏', ',': ',', '.': '.', '/': '‡§Ø', 'Q': '‡§î', 'W': '‡§ê', 'E': '‡§Ü', 'R': '‡§à', 'T': '‡§ä', 'Y': '‡§≠', 'U': '‡§ô', 'I': '‡§ò', 'O': '‡§ß', 'P': '‡§ù', '{': '‡§¢', '}': '‡§û', 'A': '‡§ì', 'S': '‡§è', 'D': '‡§Ö', 'F': '‡§á', 'G': '‡§â', 'H': '‡§´', 'J': '‡§±', 'K': '‡§ñ', 'L': '‡§•', ':': '‡§õ', '"': '‡§†', 'Z': '‡§é', 'X': '‡§Å', 'C': '‡§£', 'V': '‡§©', 'B': '‡§¥', 'N': '‡§≥', 'M': '‡§∂', '<': '‡§∑', '>': '‡•§', '?': '‡§Ø‡§º', '1': '‡•ß', '2': '‡•®', '3': '‡•©', '4': '‡•™', '5': '‡•´', '6': '‡•¨', '7': '‡•≠', '8': '‡•Æ', '9': '‡•Ø', '0': '‡•¶', '!': '‡§ç', '@': '‡•Ö', '#': '‡•ç‡§∞', '$': '‡§∞‡•ç', '%': '‡§ú‡•ç‡§û', '^': '‡§§‡•ç‡§∞', '&': '‡§ï‡•ç‡§∑', '*': '‡§∂‡•ç‡§∞', '-': '-', '+': '‡§ã', '_': '‡§É', '=': '‡•É', '~': '‡§í', '`': '‡•ä', '(': ')', ')': '(', '|': '‡§ë', '\\': '‡•â' }, indicMap = { 'a': '‡§Ö', 'A': '‡§æ', 'b': '‡§¨', 'B': '‡§≠', 'c': '‡§ö', 'C': '‡§õ', 'd': '‡§¶', 'D': '‡§ß', 'e': '‡•á', 'E': '‡•à', 'f': '‡§´', 'F': '‡§´‡§º', 'g': '‡§ó', 'G': '‡§ò', 'h': '‡§π', 'H': '‡§É', 'i': '‡§ø', 'I': '‡•Ä', 'j': '‡§ú', 'J': '‡§ù', 'k': '‡§ï', 'K': '‡§ñ', 'l': '‡§≤', 'L': '‡§≥', 'm': '‡§Æ', 'M': '‡§Ç', 'n': '‡§®', 'N': '‡§£', 'o': '‡•ã', 'O': '‡•å', 'p': '‡§™', 'P': '‡§´', 'r': '‡§∞', 'R': '‡•É', 's': '‡§∏', 'S': '‡§∂', 't': '‡§§', 'T': '‡§•', 'u': '‡•Å', 'U': '‡•Ç', 'v': '‡§µ', 'x': '‡§ï‡•ç‡§∑', 'X': '‡§ú‡•ç‡§û', 'y': '‡§Ø', '.': '‡•§', '_': '', '!': '!', '@': '@', '#': '#', '$': '$', '%': '%', '^': '^', '&': '&', '*': '*', '(': '(', ')': ')', '-': '-', '+': '+', '=': '=', '{': '{', '}': '}', '[': '[', ']': ']', '|': '|', '\\': '\\', '<': '<', '>': '>', '?': '?', '/': '/', '\'': '\'', '"': '"', '`': '`', '~': '~' }, IM = { 'g': remGailMap, 'c': remCBIMap, 'i': inscriptMap, 'p': indicMap }, VM = { '‡§Ö': '', '‡§Ü': '‡§æ', '‡§á': '‡§ø', '‡§à': '‡•Ä', '‡§â': '‡•Å', '‡§ä': '‡•Ç', '‡§è': '‡•á', '‡§ê': '‡•à', '‡§ì': '‡•ã', '‡§î': '‡•å', '‡§ã': '‡•É', '‡§ç': '‡•Ö' }, RM = { '1': '1', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', '0': '0' }, LM = { '1': '‡•ß', '2': '‡•®', '3': '‡•©', '4': '‡•™', '5': '‡•´', '6': '‡•¨', '7': '‡•≠', '8': '‡•Æ', '9': '‡•Ø', '0': '‡•¶' }; let cm = "", stT, tmr, fT = "", plist = {}, sc = 1, tfs = 1.1, bsc = 0, pn = "", lib = [], imeS = { wI: false, dK: false, pK: '', nI: false, altBypass: false }, editIdx = -1;
        const src = [{ t: "Registry", u: "https://gist.githubusercontent.com/vs-parihar/80a61d62dd93b9e496a8db28ad9eee5c/raw/registry.json", m: 0 }, { t: "English", u: "https://api.github.com/gists/f5bf18c404ac6c4649b207a2cb83aefd", m: 1 }, { t: "Hindi", u: "https://api.github.com/gists/8e9911bc62761d6fb5407d8b76d67c97", m: 1 }, { t: "Local", u: "assets/matters", m: 2 }];
        const get = (id) => document.getElementById(id), sm = (id) => { document.querySelectorAll('.m').forEach(m => m.classList.remove('active')); get(id).classList.add('active') };
        const ui = (t) => { if (t === 'd') document.body.classList.toggle('dark'); if (t === 't+') tfs += 0.05; if (t === 't-') tfs -= 0.05; if (t === 's+') sc += 0.05; if (t === 's-') sc -= 0.05; document.documentElement.style.setProperty('--tfs', tfs + 'rem'); document.body.style.setProperty('--sc', sc); svC() };
        document.querySelectorAll('.cb').forEach(c => { const f = `<button onclick="ui('t+')">A+</button><button onclick="ui('t-')">A-</button>`; c.innerHTML = `<button onclick="ui('d')">üåì</button>${c.dataset.type !== 'n' ? f : ''}<button onclick="ui('s+')">Z+</button><button onclick="ui('s-')">Z-</button>` });
        const svC = () => localStorage.setItem('tp_v42', JSON.stringify({ un: get('un').value, tl: get('tl').value, ime: get('ime').value, ip: get('ip').value, pt: get('pt').checked, bk: get('bk').checked, hi: get('hi').checked, as: get('as').checked, wl: get('wl').checked, wv: get('wv').value, dark: document.body.classList.contains('dark'), sc, tfs, lib, ps_val: get('ps').value, ms_idx: get('ms').selectedIndex, cms_idx: get('cms').selectedIndex }));
        const ldC = () => { const c = JSON.parse(localStorage.getItem('tp_v42')); if (!c) { tp(false); return } get('un').value = c.un; get('tl').value = c.tl; get('ime').value = c.ime || 'e'; get('ip').value = c.ip || 5; get('pt').checked = c.pt; get('bk').checked = c.bk; get('hi').checked = c.hi; get('as').checked = c.as; get('wl').checked = c.wl; get('wv').value = c.wv; get('wv').style.display = c.wl ? 'inline' : 'none'; if (c.dark) document.body.classList.add('dark'); else document.body.classList.remove('dark'); sc = c.sc || 1; tfs = c.tfs || 1.1; lib = c.lib || []; rlb(); tp(c.pt); ui('') };
        const rlb = () => { const s = get('cms'), l = get('ll'); s.innerHTML = ''; l.innerHTML = ''; lib.forEach((m, i) => { s.innerHTML += `<option value="${i}">${m.t}</option>`; l.innerHTML += `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid var(--bd)"><span style="font-size:0.85rem">${m.t}</span><div style="display:flex;gap:4px"><button class="bs" onclick="edl(${i})">Edit</button><button class="bs" onclick="rml(${i})" style="color:#ef4444">X</button></div></div>` }) };
        const al = () => { const t = get('ct').value, x = get('cx').value; if (!x.trim()) return; if (editIdx > -1) { lib[editIdx] = { t: t || (x.slice(0, 12) + '...'), x: x.trim() }; editIdx = -1; get('lib-save-btn').textContent = "Add to Library" } else { lib.push({ t: t || (x.slice(0, 12) + '...'), x: x.trim() }) } get('ct').value = ''; get('cx').value = ''; rlb(); svC() };
        const edl = (i) => { editIdx = i; get('ct').value = lib[i].t; get('cx').value = lib[i].x; get('lib-save-btn').textContent = "Update Matter" };
        const rml = (i) => { if (confirm("Delete this matter?")) { lib.splice(i, 1); rlb(); svC() } };
        const tp = (v) => { document.querySelectorAll('.du').forEach(e => e.style.display = v ? 'none' : 'flex'); document.querySelectorAll('.cu').forEach(e => e.style.display = v ? 'flex' : 'none') };
        const lp = (n) => { const s = get('ms'); s.innerHTML = ''; pn = n; if (plist[n]) plist[n].forEach((m, i) => s.innerHTML += `<option value="${i}">${m.title}</option>`) };
        const nm = (t) => t ? t.normalize('NFC').replace(/[\u200B-\u200D\uFEFF]/g, '').replace(/[‚Äò‚Äô]/g, "'").replace(/[‚Äú‚Äù]/g, '"').replace(/‡§æ‡•á/g, '‡•ã').replace(/‡§æ‡•à/g, '‡•å').trim() : "";
        async function init() {
            ldC(); for (let s of src) {
                try {
                    if (s.m === 2) {
                        for (let i = 1; i <= 10; i++) {
                            const pN = `Playlist ${i}`, u = `${s.u}/${pN}/matter.txt`;
                            try { const r = await fetch(u); if (r.ok) { if (!plist[pN]) plist[pN] = []; plist[pN].push({ title: `Matter ${i}`, matter: u }) } } catch (e) { }
                        }
                    } else {
                        const r = await fetch(s.u), d = await r.json();
                        if (s.m === 0) { for (let p of d) { const rI = p.id.split('/').pop(), pr = await fetch(`https://gist.githubusercontent.com/vs-parihar/${rI}/raw/playlist.json`), pl = await pr.json(); if (!plist[p.title]) plist[p.title] = []; plist[p.title].push(...pl) } }
                        else { if (!plist[s.t]) plist[s.t] = []; Object.values(d.files).forEach(f => plist[s.t].push({ title: f.filename, matter: f.raw_url })) }
                    }
                } catch (e) { }
            }
            const pS = get('ps'); Object.keys(plist).forEach(k => pS.innerHTML += `<option value="${k}">${k}</option>`);
            const c = JSON.parse(localStorage.getItem('tp_v42')); if (c) { if (c.ps_val) pS.value = c.ps_val; lp(pS.value); if (c.ms_idx !== undefined) get('ms').selectedIndex = c.ms_idx; if (c.cms_idx !== undefined) get('cms').selectedIndex = c.cms_idx } else if (pS.options.length) { lp(pS.value) }
        }
        async function st() {
            svC(); const b = get('sb'), ot = b.textContent; let mName = ""; b.disabled = true; b.textContent = "Wait...";
            if (get('pt').checked) { if (!lib.length) { b.textContent = ot; return (b.disabled = false) } const sel = lib[get('cms').value]; cm = sel.x; mName = sel.t; pn = "Library" }
            else {
                const m = plist[pn] ? plist[pn][get('ms').value] : null; mName = m ? m.title : "Matter";
                try { if (m && m.matter) cm = await (await fetch(m.matter)).text(); else if (m && m.raw_url) cm = await (await fetch(m.raw_url)).text(); else if (m && m.url) { const d = await (await fetch(`https://archive.org/metadata/${m.url.split('/').pop()}`)).json(); cm = (d.metadata.description || m.title).replace(/<[^>]*>/g, '') } else cm = m ? m.title : "" } catch (e) { cm = m ? m.title : "" }
            } setup(cm, mName); b.disabled = false; b.textContent = ot
        }
        function setup(txt, mName) {
            let w = txt.split(/\s+/).filter(x => x); if (get('wl').checked) w = w.slice(0, parseInt(get('wv').value)); fT = w.join(' '); const tt = get('tt');
            tt.scrollTop = 0; tt.classList.toggle('as-on', get('as').checked); tt.innerHTML = w.map(x => `<span>${x}</span>`).join('');
            const iS = get('ime'), kName = iS.options[iS.selectedIndex].text, trunc = (s, l) => s.length > l ? s.slice(0, l) + '...' : s; get('typing-info').textContent = `${kName} ‚Ä¢ ${trunc(mName, 15)}`;
            const i = get('ia'); i.value = ''; bsc = 0; sm('typ'); i.focus(); imeS = { wI: false, dK: false, pK: '', nI: false, altBypass: false }; stT = new Date(); const lim = get('tl').value * 60;
            clearInterval(tmr); tmr = setInterval(() => { const e = Math.floor((new Date() - stT) / 1000), r = lim - e; if (r <= 0) ft(); get('lt').textContent = `${Math.floor(r / 60)}:${(r % 60).toString().padStart(2, '0')}` }, 1000);
            i.onkeydown = (e) => {
                const mod = get('ime').value; imeS.altBypass = e.altKey; if (e.altKey) return;
                if (mod !== 'e' && ((e.code.startsWith('Numpad') && /[0-9]/.test(e.key)) || (/[0-9]/.test(e.key) && !e.ctrlKey))) {
                    imeS.nI = true; const c = get('ia'), s = c.selectionStart, v = c.value, k = e.key, cl = e.getModifierState('CapsLock');
                    const num = cl ? RM[k] : LM[k]; e.preventDefault(); c.value = v.slice(0, s) + num + v.slice(c.selectionEnd); c.setSelectionRange(s + num.length, s + num.length); c.dispatchEvent(new Event('input')); return
                } else { imeS.nI = false }
                if (mod === 'i' && e.ctrlKey && e.shiftKey) { if (e.key === '!') { e.preventDefault(); insC('\u200D') } if (e.key === '@') { e.preventDefault(); insC('\u200C') } }
                if (e.key === 'Backspace') {
                    imeS.wI = false; imeS.pK = ''; const v = i.value, s = i.selectionStart;
                    if (mod === 'g' || mod === 'c') { if (v.slice(s - 2, s) === '\u25cc\u093f') { e.preventDefault(); i.value = v.slice(0, s - 2) + v.slice(s); i.setSelectionRange(s - 2, s - 2); i.dispatchEvent(new Event('input')); return } if (v.charAt(s - 1) === '\u093f') { e.preventDefault(); i.value = v.slice(0, s - 2) + v.slice(s); i.setSelectionRange(s - 2, s - 2); i.dispatchEvent(new Event('input')); return } }
                    bsc++; if (!get('bk').checked) e.preventDefault()
                }
            };
            const insC = (c) => { const st = i.selectionStart, v = i.value; i.value = v.slice(0, st) + c + v.slice(i.selectionEnd); i.setSelectionRange(st + c.length, st + c.length); i.dispatchEvent(new Event('input')) };
            i.onbeforeinput = (v) => {
                if (imeS.altBypass || v.inputType === 'insertCompositionText') return;
                if (imeS.nI) { v.preventDefault(); return }
                const mod = get('ime').value; if (mod === 'e' || v.inputType.includes('delete')) return;
                if (!v.data || v.data === ' ') { imeS.dK = false; imeS.wI = false; imeS.pK = ''; return }
                if (v.data.length > 1) return; v.preventDefault();
                let k = v.data, m = IM[mod][k] || k, char = m, st = i.selectionStart, en = i.selectionEnd, val = i.value;
                if (mod !== 'e') { let prv = val.slice(0, st); if (prv.endsWith('‡•ç')) { if (VM[char] !== undefined) { val = prv.slice(0, -1); st-- } else if (char === '‡§æ') { val = prv.slice(0, -1); st--; char = '' } } }
                if (mod === 'g' || mod === 'c') {
                    let p = val[st - 1]; if (k === 'f') { char = '\u25cc\u093f'; imeS.wI = true } else if (imeS.wI) { if (val.slice(st - 2, st) === '\u25cc\u093f') { val = val.slice(0, st - 2); st -= 2; char = char + '\u093f'; imeS.wI = false } }
                    if (k === 'k') { if (p === '‡§Ö') char = (val = val.slice(0, -1), st--, '‡§Ü'); else if (p === '‡§Ü') char = (val = val.slice(0, -1), st--, '‡§ì'); else if (p === '‡§æ') char = (val = val.slice(0, -1), st--, '‡•ã') }
                    if (k === 's') { if (p === '‡§Ü') char = (val = val.slice(0, -1), st--, '‡§ì'); else if (p === '‡§æ') char = (val = val.slice(0, -1), st--, '‡•ã'); else if (p === '‡§è') char = (val = val.slice(0, -1), st--, '‡§ê') }
                    if (k === 'S') { if (p === '‡§Ü') char = (val = val.slice(0, -1), st--, '‡§î'); else if (p === '‡§æ') char = (val = val.slice(0, -1), st--, '‡•å') }
                    if (k === 'W') { if (p === '‡§Ü') char = (val = val.slice(0, -1), st--, '‡§ë'); else if (p === '‡§æ') char = (val = val.slice(0, -1), st--, '‡•â'); else if (p === '‡§è') char = (val = val.slice(0, -1), st--, '‡§ç') }
                    if (k === 'a' && p === '‡•â') char = (val = val.slice(0, -1), st--, '‡§Å');
                    if (k === 'Q') { if (p === '‡§â') char = (val = val.slice(0, -1), st--, '‡§ä'); else if (p === '‡§™') char = (val = val.slice(0, -1), st--, '‡§´'); else if (p === '‡§∞') char = (val = val.slice(0, -1), st--, '‡§∞‡•Å') }
                } if (mod === 'p') { let prev = val[st - 1]; if (prev && VM[char] !== undefined && !/\s/.test(prev)) char = VM[char] }
                i.value = val.slice(0, st) + char + val.slice(en); i.setSelectionRange(st + char.length, st + char.length); imeS.pK = k; i.dispatchEvent(new Event('input'))
            };
            i.oninput = () => {
                const v = i.value, vW = v.split(/\s+/).filter(x => x), tW = fT.split(/\s+/), idxCur = vW.length ? vW.length - (v.endsWith(' ') ? 0 : 1) : 0; let cw = 0;
                get('tt').querySelectorAll('span').forEach((s, idx) => {
                    s.className = ''; s.style.background = ''; const u = v.split(/\s+/)[idx] || "";
                    if (idx < v.split(/\s+/).length - 1) { const isC = nm(u) === nm(tW[idx] || ""); if (isC) cw++; if (get('hi').checked) s.classList.add(isC ? 'cor' : 'inc') }
                    if (idx === idxCur) { if (get('hi').checked) s.style.background = 'rgba(79,70,229,0.3)'; if (get('as').checked) s.scrollIntoView({ block: 'center', behavior: 'smooth' }) }
                }); const m = Math.max((new Date() - stT) / 60000, 0.01), gw = (v.length / 5) / m; get('ls').textContent = `${Math.round(gw)} | ${Math.round(Math.max(0, gw - ((vW.length - cw) / m)))}`; get('la').textContent = `${Math.round(vW.length ? cw / vW.length * 100 : 0)}% | ${vW.length}`
            }
        }
        function ft() {
            clearInterval(tmr); const v = get('ia').value.trim(), tW = cm.trim().split(/\s+/).filter(x => x), vW = v.split(/\s+/).filter(x => x), dur = Math.max((new Date() - stT) / 60000, 0.1), iP = parseFloat(get('ip').value) || 0;
            let cw = 0, err = 0, dv = ""; tW.forEach((w, i) => { const u = vW[i] || ""; if (i < vW.length) { if (nm(u) !== nm(w)) { err++; dv += `<span class="inc">${w} </span>` } else { cw++; dv += `<span class="cor">${w} </span>` } } });
            const gW = (v.length / 5) / dur, gK = v.length * (60 / dur), ac = vW.length ? (cw / vW.length) * 100 : 0, m1N = Math.max(0, gW - (err / dur)), p2 = err * 10, m2N = Math.max(0, gW - (p2 / dur)), ign = Math.floor(tW.length * iP / 100), ne3 = Math.max(0, err - ign), p3 = ne3 * 10, m3N = Math.max(0, gW - (p3 / dur));
            const gKDPH = Math.round(gK), nKDPH = Math.round(m1N * 5 * (60 / dur));
            let h = `<div class="sg"><div class="mh">1. Method 1: ${pn} [net speed formula M2]</div><div class="ms">${m1N.toFixed(2)} WPM | ${nKDPH} KDPH</div><div class="rl"><span>Net Speed</span><span>${m1N.toFixed(2)} WPM</span></div><div class="rl"><span>Gross Speed</span><span>${gW.toFixed(2)} WPM | ${gKDPH} KDPH</span></div><div class="rl"><span>Accuracy</span><span>${ac.toFixed(2)} %</span></div><div class="rl"><span>Total Entries</span><span>${vW.length}</span></div><div class="rl"><span>Total Errors</span><span>${err}</span></div><div class="rl"><span>Error Rate</span><span>${(err / dur).toFixed(2)} WPM</span></div><div class="rl"><span>Backspace Pressed</span><span>${bsc}</span></div><div class="rl"><span>Duration</span><span>${Math.ceil(dur)} Min</span></div></div>`;
            h += `<div class="sg"><div class="mh">2. Method 2: ${pn} [gross speed formula M1]</div><div class="ms">${m2N.toFixed(2)} WPM | ${Math.round(m2N * 5 * (60 / dur))} KDPH</div><div class="rl"><span>Net Speed</span><span>${m2N.toFixed(2)} WPM</span></div><div class="rl"><span>Gross Speed</span><span>${gW.toFixed(2)} WPM | ${gKDPH} KDPH</span></div><div class="rl"><span>Accuracy</span><span>${m2N > 0 ? ac.toFixed(2) : '0.00'} %</span></div><div class="rl"><span>Total Entries</span><span>${vW.length}</span></div><div class="rl"><span>Total Mistakes</span><span>${err}</span></div><div class="rl"><span>Penalty</span><span>${p2}</span></div><div class="rl"><span>Error %</span><span>${(vW.length ? err / vW.length * 100 : 0).toFixed(2)} %</span></div></div>`;
            h += `<div class="sg"><div class="mh">3. ${iP}% Mistakes are ignorable</div><div class="ms">${m3N.toFixed(2)} WPM | ${Math.round(m3N * 5 * (60 / dur))} KDPH</div><div class="rl"><span>Net Speed</span><span>${m3N.toFixed(2)} WPM</span></div><div class="rl"><span>Gross Speed</span><span>${gW.toFixed(2)} WPM | ${gKDPH} KDPH</span></div><div class="rl"><span>Accuracy</span><span>${m3N > 0 ? ac.toFixed(2) : '0.00'} %</span></div><div class="rl"><span>Ignorable Mistakes</span><span>${ign}</span></div><div class="rl"><span>Net Mistakes</span><span>${ne3}</span></div><div class="rl"><span>Penalty</span><span>${p3}</span></div><div class="rl"><span>Error %</span><span>${(vW.length ? err / vW.length * 100 : 0).toFixed(2)} %</span></div></div>`;
            get('rc').innerHTML = h; get('dv').innerHTML = dv; sm('res')
        }
        window.onload = init;
    </script>
</body>

</html>