function prepCheck(){$('ldOv').style.display='flex';setTimeout(check,50)}
function check(){if(tmr)clearInterval(tmr);errs=[];rDs=[];const src=$('tx').value,typ=$('trI').value;let S=splitT(src),T=splitT(typ),n=S.length,m=T.length,dp=Array.from({length:n+1},()=>Array(m+1).fill(0));
for(let i=1;i<=n;i++)dp[i][0]=dp[i-1][0]-1000;for(let j=1;j<=m;j++)dp[0][j]=dp[0][j-1]-400;
for(let i=1;i<=n;i++)for(let j=1;j<=m;j++){if(!S[i-1]||!T[j-1]){dp[i][j]=Math.max(dp[i-1][j],dp[i][j-1])-400;continue}let vA=cNum(nm(S[i-1].v)),vB=cNum(nm(T[j-1].v));let sc=(S[i-1].t!==T[j-1].t)?-5000:(eq(vA,vB)?1000:(S[i-1].t==='w'?Math.max(-100,200-wLv(vA,vB)*50):-100));dp[i][j]=Math.max(dp[i-1][j-1]+sc,dp[i-1][j]-1000,dp[i][j-1]-1000)}
let i=n,j=m,maxS=-1e9,bi=n;for(let k=0;k<=n;k++)if(dp[k][m]>maxS){maxS=dp[k][m];bi=k}i=bi;
rDs=[];for(let k=n;k>bi;k--)rDs.unshift({k:0,v:'',sv:S[k-1]?S[k-1].v:'',t:S[k-1]?S[k-1].t:'w'});
while(i>0||j>0){if(i>0&&j>0&&S[i-1]&&T[j-1]&&eq(cNum(nm(S[i-1].v)),cNum(nm(T[j-1].v)))&&dp[i][j]==dp[i-1][j-1]+1000){rDs.unshift({k:1,v:T[j-1].v,sv:S[i-1].v,t:T[j-1].t});i--;j--}else if(i>1&&j>0&&S[i-1]&&S[i-2]&&T[j-1]&&eq(S[i-2].v+S[i-1].v,T[j-1].v)){rDs.unshift({k:4,v:T[j-1].v,sv:S[i-2].v,sv2:S[i-1].v,t:'w'});i-=2;j--}else if(j>1&&i>0&&T[j-1]&&T[j-2]&&S[i-1]&&eq(T[j-2].v+T[j-1].v,S[i-1].v)){rDs.unshift({k:4,v:T[j-2].v,v2:T[j-1].v,sv:S[i-1].v,t:'w'});i--;j-=2}else if(i>1&&j>1&&S[i-2]&&S[i-1]&&T[j-2]&&T[j-1]&&((eq(S[i-2].v,T[j-1].v)||lv(nm(S[i-2].v),nm(T[j-1].v))<2)&&(eq(S[i-1].v,T[j-2].v)||lv(nm(S[i-1].v),nm(T[j-2].v))<2))){rDs.unshift({k:5,v:T[j-1].v,sv:S[i-1].v,v2:T[j-2].v,sv2:S[i-2].v,t:'w'});i-=2;j-=2}else if(i>0&&j>0&&S[i-1]&&T[j-1]&&S[i-1].t===T[j-1].t&&S[i-1].t==='w'&&(dp[i][j]===dp[i-1][j-1]+(200-wLv(nm(S[i-1].v),nm(T[j-1].v))*50)||wLv(nm(S[i-1].v),nm(T[j-1].v))<Math.max(wSc(nm(S[i-1].v)),wSc(nm(T[j-1].v)))*0.6)){rDs.unshift({k:3,v:T[j-1].v,sv:S[i-1].v,t:T[j-1].t});i--;j--}else if(j>0&&(i===0||dp[i][j]===dp[i][j-1]-1000)){rDs.unshift({k:2,v:T[j-1]?T[j-1].v:'',sv:'',t:T[j-1]?T[j-1].t:'w'});j--}else{rDs.unshift({k:0,v:'',sv:S[i-1]?S[i-1].v:'',t:S[i-1]?S[i-1].t:'w'});i--}}
let sP=0,tP=0;rDs.forEach((r,idx)=>{if(r.sv){let fi=src.indexOf(r.sv,sP);if(fi!==-1){if(/\s/.test(src.substring(sP,fi))&&idx>0)rDs[idx-1].sSp=true;sP=fi+r.sv.length}if(r.sv2){let fi2=src.indexOf(r.sv2,sP);if(fi2!==-1){if(/\s/.test(src.substring(sP,fi2)))r.sSp1=true;sP=fi2+r.sv2.length}}}if(r.v){let fi=typ.indexOf(r.v,tP);if(fi!==-1){if(/\s/.test(typ.substring(tP,fi))&&idx>0)rDs[idx-1].tSp=true;tP=fi+r.v.length}if(r.v2){let fi2=typ.indexOf(r.v2,tP);if(fi2!==-1){if(/\s/.test(typ.substring(tP,fi2)))r.tSp1=true;tP=fi2+r.v2.length}}}});uD();$('trV').style.display='none';$('rsV').style.display='flex';svSt();$('ldOv').style.display='none';if(exMd==='mock')exitMk(true)}
function getErr(s,t){if(nm(s)===nm(t))return [];let eT=[],sN=nm(s),tN=nm(t),wd=wLv(sN,tN),ws=Math.max(wSc(sN),wSc(tN));if(wd>=ws*0.5)return ["Substitution"];if(nz(s)===nz(t))eT.push("Panchamakshar");let isY=ny(sN)===ny(tN),isP=np(sN)===np(tN),isYP=ny(np(sN))===ny(np(tN));if(isY&&!isP)eT.push("Pluralisation");if(isP&&!isY)eT.push("Ya+Shruti");if(isYP&&!isY&&!isP)eT.push("Ya+Shruti","Pluralisation");if(eT.length===0){const diffs=getChD(sN,tN);if(diffs.length)eT.push(...diffs);else eT.push("Spelling")}return eT;}